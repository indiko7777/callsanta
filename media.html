<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-E2XNQGLFBX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-E2XNQGLFBX');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Magic Moment with Santa - CallSanta.us</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            background-image:
                radial-gradient(circle at 20% 50%, rgba(239, 68, 68, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(34, 197, 94, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(251, 191, 36, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        /* Snowflakes animation */
        @keyframes snowfall {
            0% {
                transform: translateY(-10vh) translateX(0);
                opacity: 0;
            }

            10% {
                opacity: 1;
            }

            90% {
                opacity: 1;
            }

            100% {
                transform: translateY(110vh) translateX(100px);
                opacity: 0;
            }
        }

        .snowflake {
            position: fixed;
            top: -10vh;
            color: rgba(255, 255, 255, 0.6);
            font-size: 1em;
            font-family: Arial, sans-serif;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
            animation: snowfall linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        .font-christmas {
            font-family: 'Mountains of Christmas', cursive;
        }

        .font-script {
            font-family: 'Crimson Text', serif;
        }

        /* Vintage paper effect for transcript */
        .vintage-paper {
            background: linear-gradient(to bottom, #f4e8d0 0%, #f0e4cc 100%);
            box-shadow:
                inset 0 0 50px rgba(139, 69, 19, 0.1),
                0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            border: 2px solid #d4a574;
        }

        .vintage-paper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(139, 69, 19, 0.03) 2px, rgba(139, 69, 19, 0.03) 4px);
            pointer-events: none;
        }

        /* SMS-style message bubbles */
        .message-santa {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            border-radius: 18px 18px 18px 4px;
            padding: 12px 16px;
            margin-bottom: 12px;
            max-width: 80%;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
            animation: slideInLeft 0.3s ease-out;
        }

        .message-child {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            border-radius: 18px 18px 4px 18px;
            padding: 12px 16px;
            margin-bottom: 12px;
            margin-left: auto;
            max-width: 80%;
            box-shadow: 0 2px 8px rgba(5, 150, 105, 0.3);
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Premium glass card */
        .glass-card {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        /* Festive gradient border */
        .festive-border {
            position: relative;
            padding: 3px;
            background: linear-gradient(135deg, #dc2626, #eab308, #22c55e, #dc2626);
            border-radius: 24px;
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
        }

        @keyframes gradientShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        .festive-border-inner {
            background: rgba(15, 23, 42, 0.95);
            border-radius: 21px;
            padding: 24px;
        }

        /* Custom audio player styling */
        audio {
            width: 100%;
            height: 60px;
            border-radius: 12px;
            filter: drop-shadow(0 4px 12px rgba(220, 38, 38, 0.3));
        }

        audio::-webkit-media-controls-panel {
            background: linear-gradient(to bottom, #fee2e2, #fecaca);
        }

        audio::-webkit-media-controls-play-button {
            background-color: #dc2626;
            border-radius: 50%;
        }

        /* Shimmer effect for upsell button */
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }

            100% {
                background-position: 1000px 0;
            }
        }

        .shimmer-button {
            background: linear-gradient(90deg, #eab308 0%, #fbbf24 25%, #fef3c7 50%, #fbbf24 75%, #eab308 100%);
            background-size: 1000px 100%;
            animation: shimmer 3s infinite;
            box-shadow:
                0 0 20px rgba(234, 179, 8, 0.5),
                0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .shimmer-button:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow:
                0 0 30px rgba(234, 179, 8, 0.7),
                0 15px 40px rgba(0, 0, 0, 0.4);
        }

        /* Ornament decorations */
        .ornament {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            position: absolute;
            box-shadow: inset 0 -5px 10px rgba(0, 0, 0, 0.3);
        }

        .ornament::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 8px;
            background: #fbbf24;
            border-radius: 2px;
        }

        /* Sticky floating CTA button */
        .sticky-cta {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
            animation: floatPulse 3s ease-in-out infinite;
        }

        @keyframes floatPulse {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .sticky-cta.hidden {
            display: none;
        }

        /* Ensure grid items are equal height on desktop */
        @media (min-width: 1024px) {
            .media-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 2rem;
            }

            .media-grid>div {
                height: 100%;
            }
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8">

    <!-- Snowflakes -->
    <div id="snowflakes"></div>

    <!-- Loading State -->
    <div id="loading" class="text-center z-10">
        <div class="relative">
            <div class="animate-spin rounded-full h-20 w-20 border-t-4 border-b-4 border-red-500 mx-auto mb-6"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <i data-lucide="gift" class="w-8 h-8 text-yellow-400 animate-pulse"></i>
            </div>
        </div>
        <p class="text-2xl font-christmas text-red-200 animate-pulse">Loading your magic moment...</p>
    </div>

    <!-- Error State -->
    <div id="error" class="hidden max-w-md w-full glass-card rounded-2xl p-8 text-center shadow-2xl z-10">
        <div class="bg-red-500/20 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
            <i data-lucide="alert-circle" class="w-10 h-10 text-red-400"></i>
        </div>
        <h2 class="text-3xl font-christmas font-bold mb-2 text-white">Oops!</h2>
        <p id="errorMessage" class="text-gray-300 mb-6">We couldn't find your magic moment.</p>
        <a href="/"
            class="inline-block bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-bold py-3 px-8 rounded-full transition-all transform hover:scale-105 shadow-lg">
            Return Home
        </a>
    </div>

    <!-- Content State -->
    <div id="content" class="hidden w-full max-w-5xl z-10">

        <!-- Header with ornaments -->
        <div class="relative mb-8">
            <div class="ornament bg-gradient-to-br from-red-500 to-red-700 top-0 left-4 sm:left-12"></div>
            <div class="ornament bg-gradient-to-br from-green-500 to-green-700 top-0 right-4 sm:right-12"></div>
            <div class="ornament bg-gradient-to-br from-yellow-400 to-yellow-600 top-12 left-20 hidden sm:block"></div>

            <div class="glass-card rounded-3xl p-6 sm:p-8 text-center relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-br from-red-900/20 via-transparent to-green-900/20"></div>
                <div class="relative">
                    <div class="inline-block mb-4">
                        <div class="bg-gradient-to-br from-yellow-400 to-yellow-600 p-4 rounded-full shadow-lg">
                            <i data-lucide="sparkles" class="w-10 h-10 sm:w-12 sm:h-12 text-white"></i>
                        </div>
                    </div>
                    <h1
                        class="text-4xl sm:text-5xl lg:text-6xl font-christmas font-bold text-white mb-2 drop-shadow-lg">
                        <span id="childNameDisplay">Your</span>'s Magic Moment
                    </h1>
                    <p class="text-red-200 text-base sm:text-lg font-script italic">A cherished memory from the North
                        Pole</p>
                </div>
            </div>
        </div>

        <div class="media-grid grid-cols-1 gap-6 lg:gap-8 mb-8">

            <!-- Audio Player Section -->
            <div id="audioSection" class="hidden">
                <div class="festive-border h-full">
                    <div class="festive-border-inner h-full flex flex-col">
                        <div class="flex items-center gap-4 mb-6">
                            <div class="bg-gradient-to-br from-red-600 to-red-800 p-3 rounded-2xl shadow-lg">
                                <i data-lucide="mic" class="w-7 h-7 text-white"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl font-christmas font-bold text-white">The Call Recording</h2>
                                <p class="text-sm text-gray-400 font-script" id="callDurationDisplay">Duration: 0:00</p>
                            </div>
                        </div>

                        <div
                            class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-2xl p-6 backdrop-blur-sm border border-white/10 mb-4 flex-grow flex items-center justify-center">
                            <audio id="audioPlayer" controls class="w-full">
                                Your browser does not support the audio element.
                            </audio>
                        </div>

                        <a id="downloadAudioBtn" href="#" download
                            class="inline-flex items-center justify-center gap-2 text-sm text-red-300 hover:text-red-200 transition-colors bg-red-900/30 hover:bg-red-900/50 py-3 px-4 rounded-xl border border-red-500/30">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span class="font-semibold">Download Recording</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Video Player Section -->
            <div id="videoSection" class="hidden">
                <div class="festive-border h-full">
                    <div class="festive-border-inner h-full flex flex-col">
                        <div class="flex items-center gap-4 mb-6">
                            <div class="bg-gradient-to-br from-green-600 to-green-800 p-3 rounded-2xl shadow-lg">
                                <i data-lucide="video" class="w-7 h-7 text-white"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl font-christmas font-bold text-white">Personalized Video</h2>
                                <p class="text-sm text-gray-400 font-script">Direct from Santa's Workshop</p>
                            </div>
                        </div>

                        <div
                            class="aspect-video bg-black rounded-2xl overflow-hidden shadow-2xl mb-4 border-2 border-green-500/30">
                            <video id="videoPlayer" controls class="w-full h-full">
                                Your browser does not support the video tag.
                            </video>
                        </div>

                        <a id="downloadVideoBtn" href="#" download
                            class="inline-flex items-center justify-center gap-2 text-sm text-green-300 hover:text-green-200 transition-colors bg-green-900/30 hover:bg-green-900/50 py-3 px-4 rounded-xl border border-green-500/30">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span class="font-semibold">Download Video</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transcript Section - Full Width Vintage Paper -->
        <div id="transcriptSection" class="hidden mb-8">
            <div class="vintage-paper rounded-3xl p-6 sm:p-8 lg:p-10">
                <div class="flex items-center gap-4 mb-6 pb-4 border-b-2 border-amber-900/30">
                    <div class="bg-gradient-to-br from-amber-700 to-amber-900 p-3 rounded-2xl shadow-lg">
                        <i data-lucide="scroll-text" class="w-7 h-7 text-amber-100"></i>
                    </div>
                    <div>
                        <h2 class="text-3xl font-christmas font-bold text-amber-900">The Conversation</h2>
                        <p class="text-sm text-amber-800 font-script italic">Every magical word preserved</p>
                    </div>
                </div>

                <div id="transcriptContent" class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
                    <!-- Transcript messages will be injected here -->
                </div>
            </div>
        </div>

        <!-- Premium Upsell Section -->
        <div class="glass-card rounded-3xl p-6 sm:p-8 lg:p-10 text-center relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-br from-yellow-900/20 via-transparent to-yellow-900/20"></div>
            <div class="relative">
                <div class="inline-block mb-4">
                    <div
                        class="bg-gradient-to-br from-yellow-400 to-yellow-600 p-4 rounded-full shadow-lg animate-pulse">
                        <i data-lucide="phone-call" class="w-10 h-10 text-white"></i>
                    </div>
                </div>
                <h3 class="text-3xl sm:text-4xl font-christmas font-bold text-white mb-3">
                    Santa Wants to Talk Again!
                </h3>
                <p class="text-gray-300 text-base sm:text-lg mb-6 max-w-2xl mx-auto font-script">
                    Book a magical return call where Santa will <span class="text-yellow-400 font-semibold">remember
                        everything</span> from this conversation. Watch the wonder in their eyes when Santa recalls
                    their wishes!
                </p>

                <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-6">
                    <div class="flex items-center gap-2 text-gray-400">
                        <i data-lucide="check-circle" class="w-5 h-5 text-green-400"></i>
                        <span>Personalized Follow-up</span>
                    </div>
                    <div class="flex items-center gap-2 text-gray-400">
                        <i data-lucide="check-circle" class="w-5 h-5 text-green-400"></i>
                        <span>Recording Included</span>
                    </div>
                    <div class="flex items-center gap-2 text-gray-400">
                        <i data-lucide="check-circle" class="w-5 h-5 text-green-400"></i>
                        <span>50% Off Special</span>
                    </div>
                </div>

                <div class="mb-6">
                    <span class="text-gray-400 line-through text-xl mr-3">$20.00</span>
                    <span class="text-5xl font-bold text-white">$10.00</span>
                </div>

                <a href="/upgrade/return-call" id="returnCallBtn"
                    class="shimmer-button inline-flex items-center justify-center gap-3 text-black font-bold text-base sm:text-lg py-4 px-8 sm:px-10 rounded-full transition-all transform hover:scale-105">
                    <i data-lucide="sparkles" class="w-5 h-5"></i>
                    <span>Book Return Call Now</span>
                    <i data-lucide="arrow-right" class="w-5 h-5"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Sticky Floating CTA Button -->
    <button id="stickyCtaBtn"
        class="sticky-cta hidden shimmer-button inline-flex items-center justify-center gap-2 text-black font-bold text-sm py-3 px-6 rounded-full transition-all shadow-2xl">
        <i data-lucide="phone-call" class="w-4 h-4"></i>
        <span class="hidden sm:inline">Book Return Call</span>
        <span class="sm:hidden">Return Call</span>
    </button>

    <script>
        // Create snowflakes
        function createSnowflakes() {
            const snowflakesContainer = document.getElementById('snowflakes');
            const snowflakeCount = 50;

            for (let i = 0; i < snowflakeCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.textContent = 'â„';
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.animationDuration = (Math.random() * 10 + 10) + 's';
                snowflake.style.animationDelay = Math.random() * 10 + 's';
                snowflake.style.fontSize = (Math.random() * 0.5 + 0.5) + 'em';
                snowflakesContainer.appendChild(snowflake);
            }
        }

        createSnowflakes();
        lucide.createIcons();

        async function loadMedia() {
            const params = new URLSearchParams(window.location.search);
            const orderId = params.get('order');
            const accessCode = params.get('code');

            if (params.get('demo') === 'true') {
                // Demo Mode
                document.getElementById('childNameDisplay').textContent = 'Timmy';
                document.getElementById('audioSection').classList.remove('hidden');
                document.getElementById('videoSection').classList.remove('hidden');
                document.getElementById('transcriptSection').classList.remove('hidden');
                document.getElementById('transcriptContent').innerHTML = '<div class="message-santa"><strong>Santa:</strong> Ho ho ho! Hello Timmy!</div><div class="message-child"><strong>Timmy:</strong> Hi Santa!</div>';
                document.getElementById('content').classList.remove('hidden');
                document.getElementById('loading').classList.add('hidden');
                lucide.createIcons();
                return;
            }

            if (!orderId || !accessCode) {
                showError('Missing order information.');
                return;
            }

            try {
                const response = await fetch(`/.netlify/functions/get-media?orderId=${orderId}&accessCode=${accessCode}`);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to load media');
                }

                // Update UI with data
                const childName = data.childName || 'Child';
                document.getElementById('childNameDisplay').textContent = childName;

                // Update Return Call Link
                const returnBtn = document.getElementById('returnCallBtn');
                returnBtn.href = `/upgrade/return-call?order=${accessCode}`;

                let hasContent = false;

                // Handle Audio
                if (data.audioUrl) {
                    document.getElementById('audioSection').classList.remove('hidden');
                    const audioPlayer = document.getElementById('audioPlayer');
                    audioPlayer.src = data.audioUrl;
                    document.getElementById('downloadAudioBtn').href = data.audioUrl;

                    if (data.callDuration) {
                        const minutes = Math.floor(data.callDuration / 60);
                        const seconds = data.callDuration % 60;
                        document.getElementById('callDurationDisplay').textContent = `Duration: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    }
                    hasContent = true;
                }

                // Handle Video
                if (data.videoUrl) {
                    document.getElementById('videoSection').classList.remove('hidden');
                    const videoPlayer = document.getElementById('videoPlayer');
                    videoPlayer.src = data.videoUrl;
                    document.getElementById('downloadVideoBtn').href = data.videoUrl;
                    hasContent = true;
                }

                // Handle Transcript with SMS-style bubbles
                if (data.transcript) {
                    document.getElementById('transcriptSection').classList.remove('hidden');
                    const transcriptDiv = document.getElementById('transcriptContent');

                    const lines = data.transcript.split('\n');
                    transcriptDiv.innerHTML = lines.map(line => {
                        if (line.trim() === '') return '';

                        // Detect speaker and create appropriate bubble
                        const santaMatch = line.match(/^(Santa|AI|Assistant):\s*(.+)/i);
                        const childMatch = line.match(/^(Child|User|Kid|[A-Z][a-z]+):\s*(.+)/i);

                        if (santaMatch) {
                            return `<div class="message-santa font-script"><strong>ðŸŽ… Santa:</strong> ${santaMatch[2]}</div>`;
                        } else if (childMatch) {
                            return `<div class="message-child font-script"><strong>${childMatch[1]}:</strong> ${childMatch[2]}</div>`;
                        } else {
                            // Default to child if no clear speaker
                            return `<div class="message-child font-script">${line}</div>`;
                        }
                    }).join('');
                    hasContent = true;
                }

                if (!hasContent) {
                    showError('No media content found for this order yet.');
                    return;
                }

                // Show Content
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');
                lucide.createIcons();
                initStickyButton(); // Initialize sticky CTA button

            } catch (error) {
                showError(error.message);
            }
        }

        function showError(msg) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
            document.getElementById('errorMessage').textContent = msg;
            lucide.createIcons();
        }

        // Sticky CTA button logic
        function initStickyButton() {
            const stickyBtn = document.getElementById('stickyCtaBtn');
            const upsellSection = document.querySelector('#content > div:last-child');

            if (!stickyBtn || !upsellSection) return;

            // Show/hide sticky button based on scroll position
            function handleScroll() {
                const upsellRect = upsellSection.getBoundingClientRect();
                const isUpsellVisible = upsellRect.top < window.innerHeight && upsellRect.bottom > 0;

                if (isUpsellVisible) {
                    stickyBtn.classList.add('hidden');
                } else {
                    stickyBtn.classList.remove('hidden');
                }
            }

            // Scroll to upsell section when clicked
            stickyBtn.addEventListener('click', () => {
                upsellSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });

            window.addEventListener('scroll', handleScroll);
            handleScroll(); // Initial check
        }

        window.addEventListener('DOMContentLoaded', loadMedia);
    </script>
</body>

</html>