<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upgrade to Ultimate Bundle - CallSanta.us</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0F172A;
            color: white;
        }


        <div class="text-center mb-8"><div class="inline-block p-4 bg-yellow-500/20 rounded-full mb-4"><i data-lucide="gift" class="w-12 h-12 text-yellow-500"></i></div><h1 class="text-3xl font-christmas font-bold text-white mb-2">Upgrade to Ultimate Bundle</h1><p class="text-gray-300">Get everything included in the bundle for a special upgrade price !</p></div><div class="bg-slate-800/50 rounded-xl p-6 mb-8 border border-slate-700"><div class="flex justify-between items-end mb-4"><span class="text-gray-300">Bundle Upgrade</span><div class="text-right"><span class="block text-sm text-gray-500 line-through">$10.00</span><span class="text-2xl font-bold text-yellow-500">$7.50</span></div></div><ul class="space-y-2 text-sm text-gray-400"><li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-green-500"></i><strong>Call Recording</strong>(MP3) </li><li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-green-500"></i><strong>Full Transcript</strong>of the chat </li><li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-green-500"></i><strong>Return Call</strong>option unlocked </li><li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-green-500"></i>Priority Support</li></ul></div><div id="payment-element" class="mb-6"></div><div id="error-message" class="text-red-400 text-sm mb-4 hidden"></div><button id="submit"
        class="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-black font-bold py-4 rounded-xl shadow-lg transform transition hover:scale-[1.02] flex items-center justify-center gap-2"><span id="button-text">Upgrade Now for $7.50</span><div id="spinner" class="hidden animate-spin rounded-full h-5 w-5 border-b-2 border-black"></div></button></div><script>lucide.createIcons();
        const stripe=Stripe('pk_test_51SVKGLLLG2IkIMjNRGtLSTgFOKHA262pTUQZxtrDko025pTqT3eqQ5o3IVThdo1Em18mtHn8OB4vbZYPgW1sgsA200melmouPY');

        const params=new URLSearchParams(window.location.search);
        const originalOrderId=params.get('order');

        if ( !originalOrderId) {
            document.body.innerHTML='<div class="text-white text-center p-10">Missing order ID. Please use the link from your email.</div>';
        }

        async function initialize() {
            const response=await fetch('/.netlify/functions/create-upgrade-payment', {

                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }

                ,
                body: JSON.stringify({
                    originalOrderId, upgradeType: 'bundle'
                }),
        });

        const {
            clientSecret,
            error
        }

        =await response.json();

        if (error) {
            document.getElementById('error-message').textContent=error;
            document.getElementById('error-message').classList.remove('hidden');
            return;
        }

        const elements=stripe.elements({
            clientSecret, appearance: {
                theme: 'night', variables: {
                    colorPrimary: '#EAB308'
                }
            }
        });
        const paymentElement=elements.create('payment');
        paymentElement.mount('#payment-element');

        document.getElementById('submit').addEventListener('click', async ()=> {
                setLoading(true);

                const {
                    error
                }

                =await stripe.confirmPayment({

                    elements,
                    confirmParams: {
                        return_url: window.location.origin + '/success.html',
                    }

                    ,
                });

            if (error) {
                document.getElementById('error-message').textContent=error.message;
                document.getElementById('error-message').classList.remove('hidden');
                setLoading(false);
            }
        });
        }

        function setLoading(isLoading) {
            if (isLoading) {
                document.getElementById('submit').disabled=true;
                document.getElementById('button-text').classList.add('hidden');
                document.getElementById('spinner').classList.remove('hidden');
            }

            else {
                document.getElementById('submit').disabled=false;
                document.getElementById('button-text').classList.remove('hidden');
                document.getElementById('spinner').classList.add('hidden');
            }
        }

        if (originalOrderId) initialize();
        </script></body></html>