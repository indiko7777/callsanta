<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Your Call Recording - CallSanta.us</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0F172A;
            color: white;
        }

        </div><h1 class="text-3xl font-christmas font-bold text-white mb-2">Keep the Magic Forever</h1><p class="text-gray-300">Get the full high-quality audio recording of your child's conversation with Santa.
 </p></div><div class="bg-slate-800/50 rounded-xl p-6 mb-8 border border-slate-700"><div class="flex justify-between items-center mb-4"><span class="text-gray-300">Call Recording</span><span class="text-2xl font-bold text-white">$5.00</span></div><ul class="space-y-2 text-sm text-gray-400"><li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-green-500"></i>High-quality MP3 download</li><li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-green-500"></i>Share with family & friends</li><li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-green-500"></i>Secure lifetime access</li></ul></div><div id="payment-element" class="mb-6"></div><div id="error-message" class="text-red-400 text-sm mb-4 hidden"></div><button id="submit"
        class="w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-bold py-4 rounded-xl shadow-lg transform transition hover:scale-[1.02] flex items-center justify-center gap-2"><span id="button-text">Pay $5.00 & Get Recording</span><div id="spinner" class="hidden animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div></button></div><script>lucide.createIcons();
        const stripe=Stripe('pk_test_51SVKGLLLG2IkIMjNRGtLSTgFOKHA262pTUQZxtrDko025pTqT3eqQ5o3IVThdo1Em18mtHn8OB4vbZYPgW1sgsA200melmouPY');
        // Note: In production, fetch PK from server or env

        // For now, hardcoding the test PK from previous context or generic placeholder if unknown.
        // Actually, let's fetch it from a config endpoint or just assume the user puts it in.
        // I will use a placeholder and ask user to verify or inject it.
        // Wait, I can see the PK in index.html usually. Let me check index.html quickly if I can...
        // I'll use a placeholder for now and update it if I find it.

        const params=new URLSearchParams(window.location.search);
        const originalOrderId=params.get('order');

        if ( !originalOrderId) {
            document.body.innerHTML='<div class="text-white text-center p-10">Missing order ID. Please use the link from your email.</div>';
        }

        async function initialize() {
            const response=await fetch('/.netlify/functions/create-upgrade-payment', {

                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }

                ,
                body: JSON.stringify({
                    originalOrderId, upgradeType: 'recording'
                }),
        });

        const {
            clientSecret,
            error
        }

        =await response.json();

        if (error) {
            document.getElementById('error-message').textContent=error;
            document.getElementById('error-message').classList.remove('hidden');
            return;
        }

        const elements=stripe.elements({
            clientSecret, appearance: {
                theme: 'night'
            }
        });
        const paymentElement=elements.create('payment');
        paymentElement.mount('#payment-element');

        document.getElementById('submit').addEventListener('click', async ()=> {
                setLoading(true);

                const {
                    error
                }

                =await stripe.confirmPayment({

                    elements,
                    confirmParams: {
                        return_url: window.location.origin + '/success.html', // Should probably have a specific upgrade success page
                    }

                    ,
                });

            if (error) {
                document.getElementById('error-message').textContent=error.message;
                document.getElementById('error-message').classList.remove('hidden');
                setLoading(false);
            }
        });
        }

        function setLoading(isLoading) {
            if (isLoading) {
                document.getElementById('submit').disabled=true;
                document.getElementById('button-text').classList.add('hidden');
                document.getElementById('spinner').classList.remove('hidden');
            }

            else {
                document.getElementById('submit').disabled=false;
                document.getElementById('button-text').classList.remove('hidden');
                document.getElementById('spinner').classList.add('hidden');
            }
        }

        if (originalOrderId) initialize();
        </script></body></html>