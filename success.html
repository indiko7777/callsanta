<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Successful - CallSanta.us</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        santa: {
                            red: '#D42426',
                            gold: '#C5A059',
                            green: '#0F5132',
                        }
                    },
                    fontFamily: {
                        'outfit': ['Outfit', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Outfit', sans-serif;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeIn {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .stagger-1 {
            animation-delay: 0.1s;
            opacity: 0;
        }

        .stagger-2 {
            animation-delay: 0.2s;
            opacity: 0;
        }

        .stagger-3 {
            animation-delay: 0.3s;
            opacity: 0;
        }

        .stagger-4 {
            animation-delay: 0.4s;
            opacity: 0;
        }

        .snowflake {
            position: absolute;
            color: rgba(255, 255, 255, 0.3);
            font-size: 1.5em;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }
    </style>
</head>

<body
    class="bg-gradient-to-br from-slate-950 via-slate-900 to-emerald-950 text-white min-h-screen flex items-center justify-center p-6 relative overflow-hidden">

    <!-- Snowflakes Background -->
    <div id="snowflakes-container"></div>

    <div class="max-w-3xl mx-auto text-center space-y-8 relative z-10">
        <!-- Success Icon -->
        <div
            class="w-24 h-24 bg-gradient-to-br from-green-400 to-emerald-600 rounded-full flex items-center justify-center mx-auto shadow-2xl shadow-green-500/50 animate-fadeIn">
            <i data-lucide="check" class="w-14 h-14 text-white"></i>
        </div>

        <!-- Main Heading -->
        <div class="animate-fadeIn stagger-1">
            <h1 class="text-5xl md:text-6xl font-bold text-white mb-3">ðŸŽ„ Payment Successful! ðŸŽ„</h1>
            <p class="text-xl md:text-2xl text-gray-300">
                <span id="greeting-message">Thank you for your purchase!</span>
            </p>
        </div>

        <!-- CALL PACKAGE SUCCESS -->
        <div id="call-success-container" class="hidden animate-fadeIn stagger-2">
            <div
                class="bg-gradient-to-br from-slate-900/90 to-slate-800/90 p-8 md:p-10 rounded-3xl border-2 border-santa-gold/30 shadow-2xl backdrop-blur-sm space-y-6">

                <div class="flex items-center justify-center gap-3 mb-4">
                    <i data-lucide="phone-call" class="w-8 h-8 text-santa-gold"></i>
                    <h2 class="text-3xl font-bold text-santa-gold">Your Live Call is Ready!</h2>
                </div>

                <!-- Access Code Display -->
                <div
                    class="bg-gradient-to-br from-santa-red/20 to-red-900/20 p-8 rounded-2xl border-2 border-santa-red shadow-xl">
                    <p class="text-sm text-gray-400 uppercase tracking-widest mb-2">Your Private Access Code</p>
                    <p id="access-code-display"
                        class="text-7xl md:text-8xl font-mono font-bold text-santa-red tracking-wider">
                        ----
                    </p>
                    <div class="mt-6 pt-6 border-t border-white/10">
                        <p class="text-gray-300 mb-2">ðŸ“ž Santa's Hotline:</p>
                        <p id="hotline-number" class="text-2xl md:text-3xl font-bold text-white">+1 (438) 795-1562</p>
                    </div>
                </div>

                <!-- Instructions -->
                <div class="text-left space-y-4 bg-slate-800/50 p-6 rounded-xl border border-white/5">
                    <h3 class="text-xl font-semibold text-santa-gold flex items-center gap-2">
                        <i data-lucide="list-checks" class="w-5 h-5"></i>
                        How to Connect with Santa:
                    </h3>
                    <ol class="space-y-3 text-gray-300 text-lg">
                        <li class="flex items-start gap-3">
                            <span
                                class="flex-shrink-0 w-8 h-8 bg-santa-red rounded-full flex items-center justify-center font-bold text-white">1</span>
                            <span><span class="font-semibold text-white">Find a quiet spot</span> with your child and
                                hand them the phone.</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span
                                class="flex-shrink-0 w-8 h-8 bg-santa-red rounded-full flex items-center justify-center font-bold text-white">2</span>
                            <span>Dial the Santa Hotline: <span class="font-bold text-white">+1 (438)
                                    795-1562</span></span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span
                                class="flex-shrink-0 w-8 h-8 bg-santa-red rounded-full flex items-center justify-center font-bold text-white">3</span>
                            <span>Enter your <span class="font-bold text-white">4-digit Access Code</span> when prompted
                                by Santa's Helper.</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span
                                class="flex-shrink-0 w-8 h-8 bg-santa-red rounded-full flex items-center justify-center font-bold text-white">4</span>
                            <span class="font-semibold text-santa-gold">Experience the magic! âœ¨</span>
                        </li>
                    </ol>
                </div>

                <!-- Overage Policy -->
                <div id="overage-policy"
                    class="text-sm text-gray-300 bg-slate-900/50 p-4 rounded-lg border border-white/5">
                    <!-- Policy details loaded here by JS -->
                </div>
            </div>
        </div>

        <!-- VIDEO PACKAGE SUCCESS -->
        <div id="video-success-container" class="hidden animate-fadeIn stagger-2">
            <div
                class="bg-gradient-to-br from-slate-900/90 to-slate-800/90 p-8 md:p-10 rounded-3xl border-2 border-purple-500/30 shadow-2xl backdrop-blur-sm space-y-6">

                <div class="flex items-center justify-center gap-3 mb-4">
                    <i data-lucide="video" class="w-8 h-8 text-purple-400"></i>
                    <h2 class="text-3xl font-bold text-purple-400">Your Santa Video is On Its Way!</h2>
                </div>

                <!-- Video Icon -->
                <div
                    class="w-32 h-32 mx-auto bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-2xl flex items-center justify-center border-2 border-purple-400/30">
                    <i data-lucide="sparkles" class="w-16 h-16 text-purple-400"></i>
                </div>

                <!-- Important Notice -->
                <div
                    class="bg-gradient-to-r from-purple-900/30 to-pink-900/30 p-6 rounded-xl border border-purple-400/20">
                    <div class="flex items-start gap-3 mb-4">
                        <i data-lucide="mail" class="w-6 h-6 text-purple-400 flex-shrink-0 mt-1"></i>
                        <div class="text-left">
                            <h3 class="text-xl font-semibold text-purple-300 mb-2">Video Delivery Information</h3>
                            <p class="text-gray-300 leading-relaxed">
                                Your personalized Santa video will be <span class="font-bold text-white">sent to your
                                    email within 24 hours</span>.
                                Our elves are working hard to create something truly magical for you!
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-gray-400 bg-slate-900/50 p-3 rounded-lg">
                        <i data-lucide="inbox" class="w-4 h-4"></i>
                        <span>Check your inbox at: <span id="video-email-display"
                                class="font-semibold text-white ml-1"></span></span>
                    </div>
                </div>

                <!-- What to Expect -->
                <div class="text-left space-y-3 bg-slate-800/50 p-6 rounded-xl border border-white/5">
                    <h3 class="text-lg font-semibold text-purple-300 flex items-center gap-2">
                        <i data-lucide="info" class="w-5 h-5"></i>
                        What to Expect:
                    </h3>
                    <ul class="space-y-2 text-gray-300">
                        <li class="flex items-start gap-2">
                            <i data-lucide="check-circle" class="w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"></i>
                            <span>A personalized video message from Santa himself</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i data-lucide="check-circle" class="w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"></i>
                            <span>High-quality video you can download and keep forever</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i data-lucide="check-circle" class="w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"></i>
                            <span>Delivery within 24 hours to your email inbox</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- BUNDLE PACKAGE SUCCESS -->
        <div id="bundle-success-container" class="hidden animate-fadeIn stagger-2">
            <div
                class="bg-gradient-to-br from-slate-900/90 to-slate-800/90 p-8 md:p-10 rounded-3xl border-2 border-santa-gold/30 shadow-2xl backdrop-blur-sm space-y-6">

                <div class="flex items-center justify-center gap-3 mb-4">
                    <i data-lucide="gift" class="w-8 h-8 text-santa-gold"></i>
                    <h2 class="text-3xl font-bold text-santa-gold">The Complete Santa Experience!</h2>
                </div>

                <!-- Access Code Display -->
                <div
                    class="bg-gradient-to-br from-santa-red/20 to-red-900/20 p-8 rounded-2xl border-2 border-santa-red shadow-xl">
                    <p class="text-sm text-gray-400 uppercase tracking-widest mb-2">Your Private Access Code</p>
                    <p id="bundle-access-code-display"
                        class="text-7xl md:text-8xl font-mono font-bold text-santa-red tracking-wider">
                        ----
                    </p>
                    <div class="mt-6 pt-6 border-t border-white/10">
                        <p class="text-gray-300 mb-2">ðŸ“ž Santa's Hotline:</p>
                        <p id="bundle-hotline-number" class="text-2xl md:text-3xl font-bold text-white">+1 (438)
                            795-1562</p>
                    </div>
                </div>

                <!-- Call Instructions -->
                <div class="text-left space-y-4 bg-slate-800/50 p-6 rounded-xl border border-white/5">
                    <h3 class="text-xl font-semibold text-santa-gold flex items-center gap-2">
                        <i data-lucide="phone-call" class="w-5 h-5"></i>
                        Call Santa Now - Unlimited Time!
                    </h3>
                    <ol class="space-y-3 text-gray-300 text-lg">
                        <li class="flex items-start gap-3">
                            <span
                                class="flex-shrink-0 w-8 h-8 bg-santa-red rounded-full flex items-center justify-center font-bold text-white">1</span>
                            <span><span class="font-semibold text-white">Find a quiet spot</span> with your child and
                                hand them the phone.</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span
                                class="flex-shrink-0 w-8 h-8 bg-santa-red rounded-full flex items-center justify-center font-bold text-white">2</span>
                            <span>Dial the Santa Hotline: <span class="font-bold text-white">+1 (438)
                                    795-1562</span></span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span
                                class="flex-shrink-0 w-8 h-8 bg-santa-red rounded-full flex items-center justify-center font-bold text-white">3</span>
                            <span>Enter your <span class="font-bold text-white">4-digit Access Code</span> when
                                prompted.</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span
                                class="flex-shrink-0 w-8 h-8 bg-santa-red rounded-full flex items-center justify-center font-bold text-white">4</span>
                            <span class="font-semibold text-santa-gold">Enjoy unlimited talk time with Santa! âœ¨</span>
                        </li>
                    </ol>
                </div>

                <!-- Bundle Benefits -->
                <div class="grid md:grid-cols-2 gap-4">
                    <!-- SMS Follow-ups -->
                    <div
                        class="bg-gradient-to-br from-blue-900/20 to-indigo-900/20 p-5 rounded-xl border border-blue-400/20">
                        <div class="flex items-start gap-3">
                            <i data-lucide="message-square-more" class="w-6 h-6 text-blue-400 flex-shrink-0 mt-1"></i>
                            <div class="text-left">
                                <h4 class="text-lg font-semibold text-blue-300 mb-2">Personalized SMS Messages</h4>
                                <p class="text-sm text-gray-300 leading-relaxed">
                                    Your child will receive <span class="font-bold text-white">personalized text
                                        messages from Santa</span> leading up to Christmas, keeping the magic alive!
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Call Recording & Transcript -->
                    <div
                        class="bg-gradient-to-br from-emerald-900/20 to-teal-900/20 p-5 rounded-xl border border-emerald-400/20">
                        <div class="flex items-start gap-3">
                            <i data-lucide="mic" class="w-6 h-6 text-emerald-400 flex-shrink-0 mt-1"></i>
                            <div class="text-left">
                                <h4 class="text-lg font-semibold text-emerald-300 mb-2">Audio Keepsake</h4>
                                <p class="text-sm text-gray-300 leading-relaxed">
                                    <span class="font-bold text-white">Call recording & transcript</span> will be sent
                                    to your email within 24 hours. Relive the magic anytime!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Email Delivery Notice -->
                <div
                    class="bg-gradient-to-r from-purple-900/30 to-pink-900/30 p-6 rounded-xl border border-purple-400/20">
                    <div class="flex items-start gap-3">
                        <i data-lucide="mail" class="w-6 h-6 text-purple-400 flex-shrink-0 mt-1"></i>
                        <div class="text-left flex-1">
                            <h3 class="text-xl font-semibold text-purple-300 mb-2">
                                <i data-lucide="sparkles" class="w-5 h-5 inline mr-1"></i>
                                What's Coming to Your Email
                            </h3>
                            <ul class="space-y-2 text-gray-300 text-sm mb-3">
                                <li class="flex items-start gap-2">
                                    <i data-lucide="check-circle"
                                        class="w-4 h-4 text-green-400 flex-shrink-0 mt-0.5"></i>
                                    <span><span class="font-bold text-white">Call recording</span> - Download and listen
                                        to the magical conversation</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i data-lucide="check-circle"
                                        class="w-4 h-4 text-green-400 flex-shrink-0 mt-0.5"></i>
                                    <span><span class="font-bold text-white">Full transcript</span> - Read every word
                                        Santa said</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i data-lucide="check-circle"
                                        class="w-4 h-4 text-green-400 flex-shrink-0 mt-0.5"></i>
                                    <span><span class="font-bold text-white">Delivery within 24 hours</span> to your
                                        inbox</span>
                                </li>
                            </ul>
                            <div class="flex items-center gap-2 text-sm text-gray-400 bg-slate-900/50 p-3 rounded-lg">
                                <i data-lucide="inbox" class="w-4 h-4"></i>
                                <span>Check your inbox at: <span id="bundle-email-display"
                                        class="font-semibold text-white ml-1"></span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Information -->
        <div class="animate-fadeIn stagger-3">
            <div class="bg-slate-900/50 border border-white/10 rounded-xl p-5 backdrop-blur-sm">
                <p class="text-gray-300 flex items-center justify-center gap-2 flex-wrap">
                    <i data-lucide="help-circle" class="w-5 h-5 text-santa-gold"></i>
                    <span>Questions? Contact us at:</span>
                    <a href="mailto:info@callsanta.us"
                        class="font-semibold text-santa-gold hover:text-santa-red transition-colors">
                        info@callsanta.us
                    </a>
                </p>
            </div>
        </div>

        <!-- Return Home Button -->
        <div class="animate-fadeIn stagger-4">
            <a href="/"
                class="inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-santa-red to-red-700 hover:from-red-700 hover:to-santa-red rounded-xl font-semibold text-lg transition-all duration-300 shadow-xl hover:shadow-2xl hover:scale-105">
                <i data-lucide="home" class="w-5 h-5"></i>
                Return to Home
            </a>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Create snowflakes
        function createSnowflakes() {
            const container = document.getElementById('snowflakes-container');
            const snowflakeCount = 20;

            for (let i = 0; i < snowflakeCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.innerHTML = 'â„';
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(snowflake);
            }
        }
        createSnowflakes();

        // --- CONFIGURATION ---
        const GET_ORDER_DETAILS_URL = '/.netlify/functions/get-order-details';
        const TWILIO_PHONE_NUMBER = "+1 (438) 795-1562";

        // --- MAIN FETCH FUNCTION ---
        async function fetchOrderDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const paymentIntentId = urlParams.get('payment_intent');

            if (!paymentIntentId) {
                console.error('No payment intent ID found');
                showFallbackMessage();
                return;
            }

            try {
                // Try to fetch details from the backend
                const response = await fetch(`${GET_ORDER_DETAILS_URL}?payment_intent_id=${paymentIntentId}`);

                // If backend function doesn't exist (404), fall back to localStorage
                if (!response.ok) {
                    console.log('Backend function not available, using localStorage fallback');
                    const orderData = localStorage.getItem('lastOrderData');
                    if (orderData) {
                        const data = JSON.parse(orderData);
                        displayOrderDetails(data);
                    } else {
                        showFallbackMessage();
                    }
                    return;
                }

                const data = await response.json();

                if (data.error || !data.packageId) {
                    console.error("Order lookup failed:", data.error);
                    showFallbackMessage();
                    return;
                }

                displayOrderDetails(data);

            } catch (e) {
                console.error("Network or parsing error:", e);
                // Fallback to localStorage
                const orderData = localStorage.getItem('lastOrderData');
                if (orderData) {
                    const data = JSON.parse(orderData);
                    displayOrderDetails(data);
                } else {
                    showFallbackMessage();
                }
            }
        }

        function displayOrderDetails(data) {
            const greetingMessage = document.getElementById('greeting-message');
            const callContainer = document.getElementById('call-success-container');
            const videoContainer = document.getElementById('video-success-container');
            const bundleContainer = document.getElementById('bundle-success-container');

            // Update greeting
            if (greetingMessage && data.childName) {
                greetingMessage.innerHTML = `Thank you, ${data.childName}'s parent!`;
            }

            // Hide all containers first
            callContainer.classList.add('hidden');
            videoContainer.classList.add('hidden');
            bundleContainer.classList.add('hidden');

            // Display appropriate container based on package type
            if (data.packageId === 'call') {
                displayCallSuccess(data);
            } else if (data.packageId === 'video') {
                displayVideoSuccess(data);
            } else if (data.packageId === 'bundle') {
                displayBundleSuccess(data);
            }
        }

        function displayCallSuccess(data) {
            const container = document.getElementById('call-success-container');
            const accessCodeDisplay = document.getElementById('access-code-display');
            const overagePolicy = document.getElementById('overage-policy');

            container.classList.remove('hidden');

            if (accessCodeDisplay && data.accessCode) {
                accessCodeDisplay.innerText = data.accessCode;
            }

            // Display overage policy
            if (overagePolicy) {
                if (data.overageOption === 'unlimited') {
                    overagePolicy.innerHTML = `
                        <div class="flex items-start gap-2">
                            <i data-lucide="infinity" class="w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"></i>
                            <div>
                                <strong class="text-white">Unlimited Talk Time:</strong> You selected unlimited call time. Talk as long as you'd like with no time limits!
                            </div>
                        </div>
                    `;
                } else {
                    overagePolicy.innerHTML = `
                        <div class="flex items-start gap-2">
                            <i data-lucide="info" class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"></i>
                            <div>
                                <strong class="text-white">Policy:</strong> Your call will automatically disconnect after 5 minutes to prevent extra charges.
                            </div>
                        </div>
                    `;
                }
                lucide.createIcons();
            }
        }

        function displayVideoSuccess(data) {
            const container = document.getElementById('video-success-container');
            const emailDisplay = document.getElementById('video-email-display');

            container.classList.remove('hidden');

            if (emailDisplay && data.parentEmail) {
                emailDisplay.innerText = data.parentEmail;
            }
        }

        function displayBundleSuccess(data) {
            const container = document.getElementById('bundle-success-container');
            const accessCodeDisplay = document.getElementById('bundle-access-code-display');
            const emailDisplay = document.getElementById('bundle-email-display');

            container.classList.remove('hidden');

            if (accessCodeDisplay && data.accessCode) {
                accessCodeDisplay.innerText = data.accessCode;
            }

            if (emailDisplay && data.parentEmail) {
                emailDisplay.innerText = data.parentEmail;
            }
        }

        function showFallbackMessage() {
            const greetingMessage = document.getElementById('greeting-message');
            if (greetingMessage) {
                greetingMessage.innerHTML = 'Your order was successful! Check your email for details.';
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', fetchOrderDetails);
    </script>
</body>

</html>